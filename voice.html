<html>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>jimin test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.js" integrity="sha512-4P0ZJ49OMXe3jXT+EsEaq82eNwFeyYL81LeHGzGcEhowFbTqeQ80q+NEkgsE8tHPs6aCqvi7U+XWliAjDmT5Lg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/addons/p5.sound.min.js" integrity="sha512-WzkwpdWEMAY/W8WvP9KS2/VI6zkgejR4/KTxTl4qHx0utqeyVE0JY+S1DlMuxDChC7x0oXtk/ESji6a0lP/Tdg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <script>
      function setup() {
        var socket = io();
        var recognition = new webkitSpeechRecognition();
        var synthesis = window.speechSynthesis;
        recognition.lang = "en-US";
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.onresult = event => {
          let length = event.results.length;
          let transcript = event.results[length - 1][0].transcript;
          console.log(transcript);
          socket.emit("recording", transcript);
        }
        socket.on("listening", status => {
          if (status) {
            console.log("start speaking...");
            recognition.start();
          } else {
            console.log("stopped listening...");
            recognition.stop();
          }
        });
        socket.on("respond", text => {
          let response = new SpeechSynthesisUtterance(text);
          for (let voice of synthesis.getVoices()) {
            if (voice.name == "Google UK English Male") {
              response.voice = voice;
              break;
            }
          }
          response.rate = 1;
          response.pitch = 1;
          synthesis.speak(response);
          console.log(response);
          socket.emit("response", response.text);
        });
      }
    </script>
  </head>

</html>